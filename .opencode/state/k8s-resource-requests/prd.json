{
  "prdName": "k8s-resource-requests",
  "tasks": [
    {
      "id": "resources-argo-cd",
      "category": "resources-p1",
      "description": "Add resource requests to argo-cd namespace (6 pods): application-controller (50m CPU, 1Gi mem), repo-server (10m, 512Mi), server (10m, 256Mi), redis (10m, 128Mi), applicationset-controller (10m, 128Mi), notifications-controller (10m, 128Mi)",
      "steps": [
        "Update argo-cd Helm values.yaml with resource requests for all 6 pods",
        "Create git branch resource-requests/argo-cd",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-traefik",
      "category": "resources-p1",
      "description": "Add resource requests to traefik namespace (1 pod): traefik (20m CPU, 256Mi memory)",
      "steps": [
        "Update traefik Helm values.yaml with resource requests",
        "Create git branch resource-requests/traefik",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-homeassistant",
      "category": "resources-p1",
      "description": "Add resource requests to homeassistant namespace (3 pods): home-assistant (20m, 1408Mi), esphome (10m, 128Mi), zwavejsui (20m, 256Mi)",
      "steps": [
        "Update homeassistant chart with resource requests for all 3 pods",
        "Create git branch resource-requests/homeassistant",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-postgres",
      "category": "resources-p1",
      "description": "Add resource requests to postgres namespace (2 pods): postgres (10m, 384Mi), postgres-exporter (10m, 128Mi)",
      "steps": [
        "Update postgres manifests with resource requests for both pods",
        "Create git branch resource-requests/postgres",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-open-webui",
      "category": "resources-p1",
      "description": "Add resource requests to open-webui namespace (3 pods): open-webui (10m, 1024Mi), pipelines (10m, 128Mi), tika (10m, 384Mi)",
      "steps": [
        "Update open-webui chart with resource requests for all 3 pods",
        "Create git branch resource-requests/open-webui",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-pocket-id",
      "category": "resources-p1",
      "description": "Add resource requests to pocket-id namespace (1 pod): pocket-id (10m, 128Mi)",
      "steps": [
        "Update pocket-id chart with resource requests",
        "Create git branch resource-requests/pocket-id",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-dawarich",
      "category": "resources-p2",
      "description": "Add resource requests to dawarich namespace (2 pods): dawarich (10m, 640Mi), sidekiq (10m, 384Mi)",
      "steps": [
        "Update dawarich chart with resource requests for both pods",
        "Create git branch resource-requests/dawarich",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-loki",
      "category": "resources-p2",
      "description": "Add resource requests to loki namespace (2 pods): loki (10m, 512Mi), promtail (60m, 384Mi)",
      "steps": [
        "Update loki chart with resource requests for both pods",
        "Create git branch resource-requests/loki",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-couchdb",
      "category": "resources-p2",
      "description": "Add resource requests to couchdb namespace (1 pod): couchdb (20m, 256Mi)",
      "steps": [
        "Update couchdb chart with resource requests",
        "Create git branch resource-requests/couchdb",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-wallabag",
      "category": "resources-p2",
      "description": "Add resource requests to wallabag namespace (1 deployment + 1 cronjob): wallabag (10m, 256Mi), wallabag-tagger (10m, 128Mi)",
      "steps": [
        "Update wallabag chart with resource requests for deployment and cronjob",
        "Create git branch resource-requests/wallabag",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-cert-manager",
      "category": "resources-p3",
      "description": "Add resource requests to cert-manager namespace (3 pods): cert-manager (10m, 256Mi), webhook (10m, 128Mi), cainjector (10m, 256Mi)",
      "steps": [
        "Update cert-manager Helm values.yaml with resource requests for all 3 pods",
        "Create git branch resource-requests/cert-manager",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-cloudflared",
      "category": "resources-p3",
      "description": "Add resource requests to cloudflared namespace (2 replicas): cloudflared (10m, 128Mi per pod)",
      "steps": [
        "Update cloudflared chart with resource requests",
        "Create git branch resource-requests/cloudflared",
        "Commit changes locally"
      ],
      "passes": true
    },
    {
      "id": "resources-external-dns",
      "category": "resources-p3",
      "description": "Add resource requests to external-dns namespace (1 pod): external-dns (10m, 128Mi)",
      "steps": [
        "Update external-dns chart with resource requests",
        "Create git branch resource-requests/external-dns",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-speedtest",
      "category": "resources-p3",
      "description": "Add resource requests to speedtest namespace (1 pod): speedtest (10m, 128Mi)",
      "steps": [
        "Update speedtest chart with resource requests",
        "Create git branch resource-requests/speedtest",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-kube-system",
      "category": "resources-p3",
      "description": "Add resource requests to kube-system namespace (1 pod): sealed-secrets-controller (10m, 128Mi)",
      "steps": [
        "Update sealed-secrets-controller with resource requests (determine if Helm or raw manifest)",
        "Create git branch resource-requests/kube-system",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-homepage",
      "category": "resources-p3",
      "description": "Add resource requests to homepage namespace (1 pod): homepage (10m, 256Mi)",
      "steps": [
        "Update homepage chart with resource requests",
        "Create git branch resource-requests/homepage",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-umami",
      "category": "resources-p3",
      "description": "Add resource requests to umami namespace (1 pod): umami (10m, 384Mi)",
      "steps": [
        "Update umami chart with resource requests",
        "Create git branch resource-requests/umami",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-btc-tracker",
      "category": "resources-p3",
      "description": "Add resource requests to btc-tracker namespace (1 pod): btc-tracker (10m, 256Mi)",
      "steps": [
        "Update btc-tracker manifest with resource requests",
        "Create git branch resource-requests/btc-tracker",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-sure",
      "category": "resources-p3",
      "description": "Add resource requests to sure namespace (2 pods): sure (10m, 640Mi), sure-worker (10m, 640Mi)",
      "steps": [
        "Update sure chart with resource requests for both pods",
        "Create git branch resource-requests/sure",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-rss-server",
      "category": "resources-p3",
      "description": "Add resource requests to rss-server namespace (1 pod): rss-server (10m, 128Mi)",
      "steps": [
        "Update rss-server manifest with resource requests",
        "Create git branch resource-requests/rss-server",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-scrutiny",
      "category": "resources-p3",
      "description": "Add resource requests to scrutiny namespace (1 pod): scrutiny (10m, 256Mi)",
      "steps": [
        "Update scrutiny chart with resource requests",
        "Create git branch resource-requests/scrutiny",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-nutweb",
      "category": "resources-p3",
      "description": "Add resource requests to nutweb namespace (1 pod): nutweb (10m, 128Mi)",
      "steps": [
        "Update nutweb chart with resource requests",
        "Create git branch resource-requests/nutweb",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-dnd-proxy",
      "category": "resources-p3",
      "description": "Add resource requests to dnd-proxy namespace (1 pod): dnd-proxy (10m, 128Mi)",
      "steps": [
        "Update dnd-proxy chart with resource requests",
        "Create git branch resource-requests/dnd-proxy",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-macro-track",
      "category": "resources-p3",
      "description": "Add resource requests to macro-track namespace (1 pod): macro-track (10m, 128Mi)",
      "steps": [
        "Update macro-track chart with resource requests",
        "Create git branch resource-requests/macro-track",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-mockery-ai",
      "category": "resources-p3",
      "description": "Add resource requests to mockery-ai namespace (1 pod): mockery-ai (10m, 128Mi)",
      "steps": [
        "Update mockery-ai chart with resource requests",
        "Create git branch resource-requests/mockery-ai",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-lego-ai",
      "category": "resources-p3",
      "description": "Add resource requests to lego-ai namespace (1 pod): legoai (10m, 128Mi)",
      "steps": [
        "Update lego-ai chart with resource requests",
        "Create git branch resource-requests/lego-ai",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-dns-duration",
      "category": "resources-p3",
      "description": "Add resource requests to dns-duration namespace (1 pod): dns-duration (10m, 128Mi)",
      "steps": [
        "Update dns-duration chart with resource requests",
        "Create git branch resource-requests/dns-duration",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-eero-metrics",
      "category": "resources-p3",
      "description": "Add resource requests to eero-metrics namespace (1 pod): eero-metrics (10m, 128Mi)",
      "steps": [
        "Update eero-metrics chart with resource requests",
        "Create git branch resource-requests/eero-metrics",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-metallb-system",
      "category": "resources-p3",
      "description": "Add resource requests to metallb-system namespace (5 containers): controller (10m, 256Mi), speaker (10m, 128Mi), speaker-frr (10m, 128Mi), speaker-frr-metrics (10m, 128Mi), speaker-reloader (10m, 128Mi)",
      "steps": [
        "Update metallb Helm values.yaml with resource requests for all 5 containers",
        "Create git branch resource-requests/metallb-system",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-monitoring-stack",
      "category": "resources-p3",
      "description": "Add resource requests to monitoring namespace (3 pods - excluding otelcol): grafana (10m, 384Mi), kube-state-metrics (10m, 128Mi), prometheus-node-exporter (10m, 128Mi)",
      "steps": [
        "Update grafana operator CRD with resource requests",
        "Update kube-state-metrics with resource requests",
        "Update prometheus-node-exporter with resource requests",
        "Create git branch resource-requests/monitoring-stack",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "resources-cronjobs",
      "category": "cronjobs",
      "description": "Add resource requests to CronJob templates: bl-shifts (10m, 128Mi), dns-updater (10m, 128Mi), dead-mans-snitch (10m, 128Mi), maxmind-downloader (10m, 128Mi), pmm-missing (250m, 512Mi)",
      "steps": [
        "Update bl-shifts CronJob template with resource requests",
        "Update dns-updater CronJob template with resource requests",
        "Update dead-mans-snitch CronJob template with resource requests",
        "Update maxmind-downloader CronJob template with resource requests",
        "Update pmm-missing CronJob template with resource requests (250m CPU, 512Mi)",
        "Create git branch resource-requests/cronjobs",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-argo-cd",
      "category": "pdb",
      "description": "Create Pod Disruption Budgets for argo-cd namespace: 3 PDBs (application-controller, repo-server, server) with maxUnavailable: 0",
      "steps": [
        "Create PDB for argo-cd-application-controller with maxUnavailable: 0",
        "Create PDB for argo-cd-repo-server with maxUnavailable: 0",
        "Create PDB for argo-cd-server with maxUnavailable: 0",
        "Add PDBs to kustomization.yaml in argo-cd namespace",
        "Add to resource-requests/argo-cd branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-traefik",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for traefik namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for traefik with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in traefik namespace",
        "Add to resource-requests/traefik branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-homeassistant",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for homeassistant namespace: 1 PDB (home-assistant) with maxUnavailable: 0",
      "steps": [
        "Create PDB for home-assistant with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in homeassistant namespace",
        "Add to resource-requests/homeassistant branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-postgres",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for postgres namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for postgres with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in postgres namespace",
        "Add to resource-requests/postgres branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-couchdb",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for couchdb namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for couchdb with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in couchdb namespace",
        "Add to resource-requests/couchdb branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-redis",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for redis namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for redis with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in redis namespace",
        "Create separate git branch resource-requests/redis-pdb (redis already has resource requests)",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-pocket-id",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for pocket-id namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for pocket-id with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in pocket-id namespace",
        "Add to resource-requests/pocket-id branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-open-webui",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for open-webui namespace: 1 PDB with maxUnavailable: 0",
      "steps": [
        "Create PDB for open-webui with maxUnavailable: 0",
        "Add PDB to kustomization.yaml in open-webui namespace",
        "Add to resource-requests/open-webui branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "pdb-cloudflared",
      "category": "pdb",
      "description": "Create Pod Disruption Budget for cloudflared namespace: 1 PDB with minAvailable: 1 (has 2 replicas)",
      "steps": [
        "Create PDB for cloudflared with minAvailable: 1",
        "Add PDB to kustomization.yaml in cloudflared namespace",
        "Add to resource-requests/cloudflared branch",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "alerts-setup",
      "category": "monitoring",
      "description": "Create Prometheus alert mixin directory structure and base configuration",
      "steps": [
        "Create /home/devin/Projects/homelab/charts/monitoring/mixins/kubernetes/ directory",
        "Create mixin.libsonnet with config in kubernetes directory",
        "Create alerts/ subdirectory",
        "Create git branch resource-requests/monitoring-alerts",
        "Commit directory structure and base mixin config"
      ],
      "passes": false
    },
    {
      "id": "alerts-pod-stability",
      "category": "monitoring",
      "description": "Create pod-stability.libsonnet with 4 alert rules: PodRestartingFrequently, PodOOMKilled, PodCrashLooping, PodNotReady",
      "steps": [
        "Create alerts/pod-stability.libsonnet with PodRestartingFrequently alert (rate > 0.05 restarts/hour for 15m)",
        "Add PodOOMKilled alert (OOMKilled reason detected for 1m)",
        "Add PodCrashLooping alert (CrashLoopBackOff state for 5m)",
        "Add PodNotReady alert (Non-ready state for 5m)",
        "Update main mixin.libsonnet to import kubernetes mixin",
        "Commit changes locally"
      ],
      "passes": false
    },
    {
      "id": "cleanup-pvs",
      "category": "cleanup",
      "description": "Delete 9 orphaned Persistent Volumes and verify disk space reclaimed",
      "steps": [
        "Verify no active PVCs reference the 9 orphaned PVs with kubectl get pvc --all-namespaces",
        "Delete 4x dendrite-* PVs (6 days old)",
        "Delete 3x hunyuan3d-* PVs (20-21 days old)",
        "Delete 2x comfyui-* PVs (38 days old)",
        "Delete 1x free-games-claimer PV (405 days old)",
        "Confirm disk space reclaimed on /mnt/media mount with df -h",
        "Create git branch resource-requests/cleanup-pvs",
        "Document deletion commands in commit message",
        "Push branch to origin"
      ],
      "passes": false
    }
  ],
  "context": {
    "patterns": [
      "Pattern 1: Mediaserver namespace (all pods have requests) - /home/devin/Projects/homelab/charts/mediaserver/",
      "Pattern 2: Redis statefulset (already has requests) - /home/devin/Projects/homelab/charts/redis/statefulset.yaml:49-57",
      "Pattern 3: Helm values.yaml format - Resources added via resources.requests key in values",
      "Pattern 4: Raw manifest format - Resources added directly in deployment spec under containers[].resources.requests",
      "Pattern 5: Grafana operator-managed - /home/devin/Projects/homelab/charts/monitoring/grafana-operator/grafana.yaml"
    ],
    "keyFiles": [
      "/home/devin/Projects/homelab/charts/",
      "/home/devin/Projects/homelab/charts/*/values.yaml",
      "/home/devin/Projects/homelab/charts/*/manifest.yaml",
      "/home/devin/Projects/homelab/charts/*/deployment.yaml",
      "/home/devin/Projects/homelab/charts/*/kustomization.yaml",
      "/home/devin/Projects/homelab/charts/monitoring/mixins/",
      "/home/devin/Projects/homelab/charts/monitoring/Makefile"
    ],
    "nonGoals": [
      "Resource limits (except for existing GPU allocations)",
      "Stash and Whisparr services",
      "NVIDIA device plugin components",
      "OTel Collector resource optimization",
      "Grafana dashboards for resource visualization",
      "Automated testing",
      "Resource rightsizing after deployment",
      "Multi-node cluster considerations",
      "Vertical Pod Autoscaler (VPA)",
      "Documentation updates",
      "Redis namespace (already has resource requests)"
    ]
  }
}
