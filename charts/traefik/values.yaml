traefik:
  deployment:
    additionalContainers:
      - name: netshoot
        image: nicolaka/netshoot
        command: ["/bin/bash"]
        args: ["-c", "sleep infinity"]
        securityContext:
          runAsNonRoot: false
          allowPrivilegeEscalation: false
          runAsUser: 0
          capabilities:
            add:
              - NET_ADMIN
              - NET_RAW
  globalArguments:
    - "--api.insecure"
  logs:
    general:
      format: json
      level: INFO
#    access:
#      enabled: true
#      format: json
  providers:
    kubernetesIngress:
      enabled: false
    kubernetesGateway:
      enabled: true
  gateway:
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-traefik
    listeners:
      web:
        hostname: "*.int.imdevinc.com"
        namespacePolicy: All
        forwardedHeaders:
          insecure: true
      websecure:
        hostname: "*.int.imdevinc.com"
        port: 8443
        namespacePolicy: All
        protocol: HTTPS
        certificateRefs:
          - name: wildcard-tls
        forwardedHeaders:
          insecure: true
  service:
    spec:
      externalTrafficPolicy: Local
  ports:
#    websecure:
#      middlewares:
#        - traefik-ipallowlist@kubernetescrd
    web:
      redirections:
        entryPoint:
          scheme: https
          to: websecure
#  experimental:
#    plugins:
#      traefik-oidc-auth:
#        moduleName: "github.com/sevensolutions/traefik-oidc-auth"
#        version: "v0.11.0"
